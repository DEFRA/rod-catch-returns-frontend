{% extends "layout.html" %}
{% from "back-link/macro.njk" import govukBackLink %}
{% from "button/macro.njk" import govukButton %}
{% from "table/macro.njk" import govukTable %}

{% set riverRows = [] %}
{% set salmonAndLargeTroutItems = [] %}
{% set smallCatchItems = [] %}

{% if activities.length %}
    {% for activity in activities %}
        {{ riverRows.push([
            { text: activity.river.name },
            { text: activity.days, format: "numeric" },
            { text: activity.count, format: "numeric" }
        ]) }}
    {% endfor %}
{% endif %}

{% if catches.length %}
    {% for fish in catches %}
        {{ salmonAndLargeTroutItems.push([
            { text: fish.dateCaught },
            { text: fish.activity.river.name },
            { text: fish.species.name },
            { text: fish.weight },
            { text: fish.method.name },
            { text: "Yes" if fish.released else "No" }
        ]) }}
    {% endfor %}
{% endif %}

{% if smallCatches.length %}
    {% for catch in smallCatches %}
        {{ smallCatchItems.push([
            { text: catch.month },
            { text: catch.river },
            { text: catch.fly, format: "numeric" },
            { text: catch.spinner, format: "numeric" },
            { text: catch.bait, format: "numeric" },
            { text: catch.released | replace("0", ""), format: "numeric" }
        ]) }}
    {% endfor %}
{% endif %}

{% set title = "Your catch return report for " + year %}
{% block pageTitle %}{{ title }}{% endblock %}

{% block beforeContent %}
    {{ super() }}
    {% if not locked %}
        {{ govukBackLink({
            href: "/summary",
            text: "Back"
        }) }}
    {% endif %}
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <form method="post">
            <h1 class="govuk-heading-l">{{ title }}</h1>

            {% if activities.length %}
                 {{ govukTable({
                    caption: "Rivers fished",
                    captionClasses: "govuk-heading-m",
                    firstCellIsHeader: false,
                    head: [
                        { text: "River" },
                        { text: "Total days fished", format: "numeric" },
                        { text: "Fish caught", format: "numeric" }
                    ],
                    rows: riverRows
                 }) }}


                {% if smallCatches.length %}
                    {{ govukTable({
                        caption: "Small adult sea trout (1lb and under) catches",
                        captionClasses: "govuk-heading-m",
                        firstCellIsHeader: false,
                        head: [
                            { text: "Month" },
                            { text: "River" },
                            { text: "Fly", format: "numeric" },
                            { text: "Spinner", format: "numeric" },
                            { text: "Bait", format: "numeric" },
                            { text: "Released", format: "numeric" }
                        ],
                        rows: smallCatchItems
                    }) }}
                {% endif %}

                {% if catches.length %}
                    {{ govukTable({
                        caption: "Salmon and large adult sea trout",
                        captionClasses: "govuk-heading-m",
                        firstCellIsHeader: false,
                        head: [
                            { text: "Date" },
                            { text: "River" },
                            { text: "Type" },
                            { text: "Weight" },
                            { text: "Method" },
                            { text: "Released" }
                        ],
                        rows: salmonAndLargeTroutItems
                    }) }}
                {% endif %}
            {% else %}
                {% if not locked %}
                    <p class="govuk-body-m">I confirm that I did not fish for salmon or seatrout in {{ year }}</p>
                {% else %}
                    <p class="govuk-body-m">I did not fish for salmon or seatrout in {{ year }}</p>
                {% endif %}
            {% endif %}

            {% if not locked %}
                {{ govukButton({
                    name: "continue",
                    text: "Submit catch return"
                }) }}
            {% endif %}

            {{ extra() }}
        </form>
        {% if not locked %}
            {{ summaryLink() }}
        {% else %}
            <div>
                <a id="print-link" class="govuk-link govuk-body-m" href="#" onclick="window.print();return false;">Print your catch return report</a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
